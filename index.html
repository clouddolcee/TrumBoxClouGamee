<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud Game PC - Thuê Trên Điện Thoại</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2c2c2c 100%);
            color: #e0e0e0;
            line-height: 1.6;
            position: relative;
            overflow-x: hidden;
        }
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
        }
        header {
            background: linear-gradient(90deg, #FFD700 0%, #1a1a1a 100%);
            color: #fff;
            text-align: center;
            padding: 2rem 1rem;
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.2);
            position: relative;
            z-index: 1;
        }
        header h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        header p {
            font-size: 0.9rem;
            font-weight: 300;
            opacity: 0.9;
        }
        nav {
            background: #0f0f0f;
            padding: 0.5rem 1rem;
            box-shadow: 0 2px 15px rgba(255, 215, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .hamburger {
            display: none;
            font-size: 1.5rem;
            color: #FFD700;
            cursor: pointer;
        }
        .menu {
            display: flex;
            gap: 1rem;
        }
        .menu a {
            color: #FFD700;
            text-decoration: none;
            font-size: 1rem;
            font-weight: 500;
            transition: color 0.3s ease, text-shadow 0.3s ease;
        }
        .menu a:hover {
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
        }
        .wallet {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .wallet a {
            color: #FFD700;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
        }
        .wallet a:hover {
            color: #fff;
        }
        .wallet .balance {
            color: #FFD700;
            font-size: 0.9rem;
            font-weight: 500;
        }
        .wallet .user-info {
            color: #FFD700;
            font-size: 0.9rem;
            font-weight: 500;
        }
        .wallet .logout {
            background: #FF4500;
            color: white;
            border: none;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }
        .wallet .logout:hover {
            background: #FF6347;
        }
        .container {
            max-width: 100%;
            margin: 1rem auto;
            padding: 0 0.5rem;
        }
        .section {
            background: rgba(30, 30, 30, 0.9);
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.1);
            animation: fadeInUp 0.8s ease-out;
        }
        .section h2 {
            font-family: 'Montserrat', sans-serif;
            color: #FFD700;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.8rem;
        }
        .admin-section {
            background: rgba(40, 40, 40, 0.9);
            padding: 1.5rem;
            margin-top: 1rem;
            border-radius: 10px;
            border: 1px solid #FFD700;
        }
        .admin-section h3 {
            color: #FFD700;
            font-size: 1.3rem;
            margin-bottom: 1rem;
        }
        .admin-section label {
            display: block;
            margin: 0.5rem 0 0.2rem;
            color: #FFD700;
            font-size: 0.9rem;
        }
        .admin-section input,
        .admin-section textarea {
            width: 100%;
            padding: 0.8rem;
            margin-bottom: 0.8rem;
            border: 1px solid #FFD700;
            border-radius: 8px;
            background: #2c2c2c;
            color: #e0e0e0;
            font-size: 1rem;
        }
        .admin-section button {
            background: #FFD700;
            color: #1a1a1a;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1rem;
            margin: 0.5rem 0;
            transition: background 0.3s ease;
        }
        .admin-section button:hover {
            background: #e6c200;
        }
        .admin-section table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        .admin-section th,
        .admin-section td {
            border: 1px solid #FFD700;
            padding: 0.8rem;
            text-align: left;
            font-size: 0.9rem;
        }
        .admin-section th {
            background: #FFD700;
            color: #1a1a1a;
            font-weight: 600;
        }
        .admin-section td button {
            padding: 0.5rem 1rem;
            margin: 0 0.2rem;
        }
        .pricing {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .plan {
            background: rgba(40, 40, 40, 0.9);
            padding: 1.2rem;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #FFD700;
        }
        .plan.recommended {
            background: linear-gradient(135deg, #FFD700 0%, #1a1a1a 100%);
            border: 2px solid #FFD700;
        }
        .plan.recommended::before {
            content: 'Khuyến nghị';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: #FFD700;
            color: #1a1a1a;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .plan h3 {
            font-family: 'Montserrat', sans-serif;
            color: #e0e0e0;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        .plan.recommended h3 {
            color: #1a1a1a;
        }
        .plan .price {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            color: #FFD700;
            font-weight: 700;
            margin: 0.5rem 0;
        }
        .plan.recommended .price {
            color: #1a1a1a;
        }
        .plan .subscribers {
            font-size: 0.8rem;
            color: #b0b0b0;
            margin: 0.3rem 0;
        }
        .plan p {
            font-size: 0.9rem;
            color: #d0d0d0;
            margin: 0.3rem 0;
        }
        .plan button {
            background: #FFD700;
            color: #1a1a1a;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            margin-top: 0.5rem;
            width: 100%;
            max-width: 200px;
            transition: background 0.3s ease, transform 0.2s ease;
        }
        .plan.recommended button {
            background: #1a1a1a;
            color: #FFD700;
        }
        .plan button:hover {
            background: #e6c200;
            transform: scale(1.05);
        }
        .plan.recommended button:hover {
            background: #2c2c2c;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: #1e1e1e;
            padding: 1.5rem;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            border: 1px solid #FFD700;
        }
        .modal-content h3 {
            font-family: 'Montserrat', sans-serif;
            color: #FFD700;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        .modal-content .close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #FFD700;
        }
        .modal-content .close:hover {
            color: #FF4500;
        }
        .modal-content label {
            display: block;
            margin: 0.5rem 0 0.2rem;
            font-weight: 500;
            color: #FFD700;
            text-align: left;
            font-size: 0.9rem;
        }
        .modal-content input,
        .modal-content select {
            width: 100%;
            padding: 0.8rem;
            margin-bottom: 0.8rem;
            border: 1px solid #FFD700;
            border-radius: 8px;
            font-size: 1rem;
            background: #2c2c2c;
            color: #e0e0e0;
        }
        .modal-content button {
            background: #FFD700;
            color: #1a1a1a;
            border: none;
            padding: 0.8rem;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            width: 100%;
            transition: background 0.3s ease;
        }
        .modal-content button:hover {
            background: #e6c200;
        }
        .modal-content img.qr-code {
            max-width: 150px;
            margin: 0.5rem auto;
            display: block;
            border-radius: 8px;
            border: 2px solid #FFD700;
        }
        .modal-content p {
            font-size: 0.9rem;
            color: #d0d0d0;
            margin: 0.3rem 0;
        }
        .modal-content p.note {
            font-size: 0.85rem;
            color: #FF4500;
            font-weight: 500;
            text-align: left;
        }
        .modal-content a {
            color: #FFD700;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
        }
        .modal-content a:hover {
            color: #e6c200;
        }
        .modal-content .error,
        .modal-content .success {
            font-size: 0.9rem;
            margin: 0.5rem 0;
            display: none;
        }
        .modal-content .error {
            color: #FF4500;
        }
        .modal-content .success {
            color: #FFD700;
        }
        footer {
            background: #0f0f0f;
            color: #FFD700;
            text-align: center;
            padding: 1rem;
            width: 100%;
        }
        .loading-spinner {
            display: none;
            border: 4px solid #FFD700;
            border-top: 4px solid transparent;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        .notification {
            background: rgba(255, 215, 0, 0.2);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 8px;
            border: 1px solid #FFD700;
            font-size: 0.9rem;
            color: #FFD700;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @media (max-width: 768px) {
            header {
                padding: 1.5rem 0.5rem;
            }
            header h1 {
                font-size: 1.5rem;
            }
            header p {
                font-size: 0.8rem;
            }
            .hamburger {
                display: block;
            }
            .menu {
                display: none;
                flex-direction: column;
                position: absolute;
                top: 50px;
                left: 0;
                background: #0f0f0f;
                width: 100%;
                padding: 1rem;
                box-shadow: 0 2px 10px rgba(255, 215, 0, 0.1);
            }
            .menu.active {
                display: flex;
            }
            .menu a {
                font-size: 1.1rem;
                padding: 0.5rem 0;
                display: block;
            }
            .wallet {
                gap: 0.3rem;
            }
            .wallet a, .wallet .balance, .wallet .user-info {
                font-size: 0.8rem;
            }
            .wallet .logout {
                padding: 0.3rem 0.6rem;
                font-size: 0.8rem;
            }
            .section {
                padding: 1rem;
                margin-bottom: 0.8rem;
            }
            .section h2 {
                font-size: 1.2rem;
                margin-bottom: 0.5rem;
            }
            .section p {
                font-size: 0.9rem;
            }
            .admin-section {
                padding: 1rem;
            }
            .admin-section h3 {
                font-size: 1.1rem;
            }
            .admin-section table {
                font-size: 0.8rem;
            }
            .admin-section th, .admin-section td {
                padding: 0.5rem;
            }
            .admin-section button {
                padding: 0.6rem 1rem;
                font-size: 0.9rem;
            }
            .plan {
                padding: 1rem;
            }
            .plan h3 {
                font-size: 1.1rem;
            }
            .plan .price {
                font-size: 1.3rem;
            }
            .plan .subscribers {
                font-size: 0.7rem;
            }
            .plan p {
                font-size: 0.8rem;
            }
            .plan button {
                padding: 0.7rem;
                font-size: 0.9rem;
                max-width: 180px;
            }
            .modal-content {
                padding: 1rem;
                max-width: 90%;
            }
            .modal-content h3 {
                font-size: 1.3rem;
            }
            .modal-content label {
                font-size: 0.8rem;
            }
            .modal-content input,
            .modal-content select {
                padding: 0.6rem;
                font-size: 0.9rem;
            }
            .modal-content button {
                padding: 0.7rem;
                font-size: 0.9rem;
            }
            .modal-content img.qr-code {
                max-width: 120px;
            }
            .modal-content p.note {
                font-size: 0.8rem;
            }
            footer {
                padding: 0.8rem;
                font-size: 0.8rem;
            }
            .notification {
                padding: 0.8rem;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div id="particles-js"></div>
    <header>
        <h1>Cloud Game PC</h1>
        <p>Chơi game mượt mà trên mọi thiết bị!</p>
    </header>
    <nav>
        <div class="nav-container">
            <div class="hamburger">☰</div>
            <div class="menu">
                <a href="#home">Trang Chủ</a>
                <a href="#pricing">Gói Dịch Vụ</a>
                <a href="#about">Về Chúng Tôi</a>
                <a href="#contact">Liên Hệ</a>
            </div>
            <div class="wallet">
                <span class="balance">Số dư: 0 VNĐ</span>
                <a href="#" id="topupLink">Nạp Tiền</a>
                <div id="authLinks">
                    <a href="#" id="loginLink">Đăng Nhập</a>
                    <a href="#" id="registerLink">Đăng Ký</a>
                </div>
                <div id="userInfo" style="display: none;">
                    <span class="user-info" id="userDetails"></span>
                    <button class="logout" id="logoutButton">Đăng Xuất</button>
                </div>
            </div>
        </div>
    </nav>
    <div class="container">
        <div id="notificationArea"></div>
        <div class="section" id="home">
            <h2>Chào Mừng</h2>
            <p>Chơi game PC yêu thích trên điện thoại với kết nối internet. Không cần cấu hình mạnh!</p>
            <div class="admin-section" id="adminSection" style="display: none;">
                <h3>Quản Lý Admin</h3>
                <div>
                    <h4>Tặng Số Dư</h4>
                    <label for="giftId">ID Người Dùng</label>
                    <input type="number" id="giftId" placeholder="VD: 123456">
                    <label for="giftAmount">Số Tiền (VNĐ)</label>
                    <input type="number" id="giftAmount" placeholder="VD: 10000">
                    <button onclick="giftBalanceById()">Tặng</button>
                    <p class="success" id="giftSuccess" style="display: none;">Tặng thành công!</p>
                    <p class="error" id="giftError" style="display: none;"></p>
                </div>
                <div>
                    <h4>Quản Lý Người Dùng</h4>
                    <table id="userTable">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Email</th>
                                <th>Player ID</th>
                                <th>Số Dư</th>
                                <th>Hành Động</th>
                            </tr>
                        </thead>
                        <tbody id="userTableBody"></tbody>
                    </table>
                </div>
                <div>
                    <h4>Chỉnh Gói Dịch Vụ</h4>
                    <label for="trumboxPrice">Giá Thuê Trumbox (VNĐ/giờ)</label>
                    <input type="number" id="trumboxPrice" placeholder="VD: 3000">
                    <label for="trumboxDesc">Mô Tả Trumbox</label>
                    <textarea id="trumboxDesc" placeholder="Mô tả gói Trumbox"></textarea>
                    <label for="premiumPrice">Giá Gói Nâng Cao (VNĐ)</label>
                    <input type="number" id="premiumPrice" placeholder="VD: 350000">
                    <label for="premiumDesc">Mô Tả Gói Nâng Cao</label>
                    <textarea id="premiumDesc" placeholder="Mô tả gói Nâng Cao"></textarea>
                    <button onclick="updatePlans()">Cập Nhật Gói</button>
                    <p class="success" id="planSuccess" style="display: none;">Cập nhật thành công!</p>
                    <p class="error" id="planError" style="display: none;"></p>
                </div>
                <div>
                    <h4>Thông Báo Hệ Thống</h4>
                    <label for="notificationMessage">Nội Dung Thông Báo</label>
                    <textarea id="notificationMessage" placeholder="VD: Server bảo trì 22h-23h"></textarea>
                    <button onclick="sendNotification()">Gửi</button>
                    <p class="success" id="notificationSuccess" style="display: none;">Gửi thành công!</p>
                    <p class="error" id="notificationError" style="display: none;"></p>
                </div>
                <div>
                    <h4>Lịch Sử Giao Dịch</h4>
                    <table id="transactionTable">
                        <thead>
                            <tr>
                                <th>Player ID</th>
                                <th>Loại</th>
                                <th>Số Tiền</th>
                                <th>Thời Gian</th>
                            </tr>
                        </thead>
                        <tbody id="transactionTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="section" id="pricing">
            <h2>Gói Dịch Vụ</h2>
            <div class="pricing">
                <div class="plan recommended" id="trumboxPlan">
                    <h3>Thuê Máy Trumbox</h3>
                    <p class="price">3.000 VNĐ/giờ</p>
                    <p class="subscribers">1,234 người thuê</p>
                    <p>Chơi không giới hạn game.</p>
                    <p>Hỗ trợ trên mọi thiết bị.</p>
                    <p>Băng thông ổn định, độ trễ thấp.</p>
                    <button onclick="rentTrumbox(event)">Thuê Ngay</button>
                    <div class="loading-spinner" id="trumboxSpinner"></div>
                </div>
                <div class="plan" id="premiumPlan">
                    <h3>Gói Nâng Cao</h3>
                    <p class="price">350.000 VNĐ/Vĩnh Viễn</p>
                    <p class="subscribers">567 người thuê</p>
                    <p>Truy cập toàn bộ game.</p>
                    <p>Hỗ trợ độ phân giải 4K.</p>
                    <p>Máy chủ VIP.</p>
                    <button onclick="purchasePlan('Gói Nâng Cao', 350000, event)">Mua Gói</button>
                    <div class="loading-spinner" id="premiumSpinner"></div>
                </div>
            </div>
        </div>
        <div class="section" id="about">
            <h2>Về Chúng Tôi</h2>
            <p>Dịch vụ Cloud Gaming hàng đầu tại Việt Nam, chơi game mọi lúc, mọi nơi.</p>
        </div>
        <div class="section" id="contact">
            <h2>Liên Hệ</h2>
            <p>Email: support@cloudgame.vn</p>
            <p>Hotline: 1900 1234</p>
        </div>
    </div>
    <!-- Modals -->
    <div class="modal" id="topupModal">
        <div class="modal-content">
            <span class="close" id="closeTopupModal">×</span>
            <h3>Nạp Tiền</h3>
            <form id="topupForm">
                <label for="paymentMethod">Phương Thức Thanh Toán</label>
                <select id="paymentMethod" name="paymentMethod" onchange="toggleForm()">
                    <option value="bank">Ngân Hàng VietinBank</option>
                    <option value="card">Thẻ Cào</option>
                </select>
                <div id="bankForm">
                    <p>Quét mã QR để chuyển khoản.</p>
                    <img src="https://i.imgur.com/4mmpR89.png" alt="QR Code VietinBank" class="qr-code">
                    <p class="note">Lưu ý: Số tiền nạp tối thiểu 15.000 VNĐ. Các giao dịch dưới 15.000 VNĐ sẽ không được cộng tiền.</p>
                    <p class="note">Lưu ý: Phần ghi chú khi chuyển khoản phải ghi ID tài khoản của bạn trên website (VD: 123456).</p>
                </div>
                <div id="cardForm" style="display: none;">
                    <p>Nhập mã thẻ và serial.</p>
                    <p>Tối thiểu: 10.000đ</p>
                    <label for="cardProvider">Nhà Mạng</label>
                    <select id="cardProvider" name="cardProvider">
                        <option value="viettel">Viettel</option>
                        <option value="mobifone">Mobifone</option>
                        <option value="vinaphone">Vinaphone</option>
                    </select>
                    <label for="cardAmount">Mệnh Giá (VNĐ)</label>
                    <select id="cardAmount" name="cardAmount">
                        <option value="10000">10.000</option>
                        <option value="20000">20.000</option>
                        <option value="50000">50.000</option>
                        <option value="100000">100.000</option>
                    </select>
                    <label for="cardCode">Mã Thẻ</label>
                    <input type="text" id="cardCode" name="cardCode" placeholder="Mã thẻ" required>
                    <label for="cardSerial">Số Serial</label>
                    <input type="text" id="cardSerial" name="cardSerial" placeholder="Số serial" required>
                </div>
                <button type="submit">Gửi Yêu Cầu</button>
                <div class="loading-spinner" id="topupSpinner"></div>
                <p class="success" id="topupSuccess" style="display: none;">Yêu cầu đã gửi!</p>
                <p class="error" id="topupError" style="display: none;"></p>
            </form>
        </div>
    </div>
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <span class="close" id="closeLoginModal">×</span>
            <h3>Đăng Nhập</h3>
            <form id="loginForm">
                <p class="error" id="loginError" style="display: none;"></p>
                <label for="loginEmail">Email</label>
                <input type="email" id="loginEmail" name="loginEmail" placeholder="Email" required>
                <label for="loginPassword">Mật Khẩu</label>
                <input type="password" id="loginPassword" name="loginPassword" placeholder="Mật khẩu" required>
                <button type="submit">Đăng Nhập</button>
                <div class="loading-spinner" id="loginSpinner"></div>
                <p>Chưa có tài khoản? <a href="#" id="showRegister">Đăng Ký</a></p>
            </form>
        </div>
    </div>
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <span class="close" id="closeRegisterModal">×</span>
            <h3>Đăng Ký</h3>
            <form id="registerForm">
                <p class="error" id="registerError" style="display: none;"></p>
                <p class="success" id="registerSuccess" style="display: none;">Đăng ký thành công!</p>
                <label for="registerUsername">Tên Người Dùng</label>
                <input type="text" id="registerUsername" name="registerUsername" placeholder="Tên người dùng" required>
                <label for="registerEmail">Email</label>
                <input type="email" id="registerEmail" name="registerEmail" placeholder="Email" required>
                <label for="registerPassword">Mật Khẩu</label>
                <input type="password" id="registerPassword" name="registerPassword" placeholder="Mật khẩu" required>
                <label for="confirmPassword">Xác Nhận Mật Khẩu</label>
                <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Xác nhận mật khẩu" required>
                <button type="submit" id="registerButton">Đăng Ký</button>
                <div class="loading-spinner" id="registerSpinner"></div>
                <p>Đã có tài khoản? <a href="#" id="showLogin">Đăng Nhập</a></p>
            </form>
        </div>
    </div>
    <div class="modal" id="editUserModal">
        <div class="modal-content">
            <span class="close" id="closeEditUserModal">×</span>
            <h3>Chỉnh Sửa Người Dùng</h3>
            <form id="editUserForm">
                <p class="error" id="editUserError" style="display: none;"></p>
                <p class="success" id="editUserSuccess" style="display: none;">Cập nhật thành công!</p>
                <label for="editUsername">Tên Người Dùng</label>
                <input type="text" id="editUsername" name="editUsername" required>
                <label for="editEmail">Email</label>
                <input type="email" id="editEmail" name="editEmail" required>
                <label for="editBalance">Số Dư (VNĐ)</label>
                <input type="number" id="editBalance" name="editBalance" required>
                <input type="hidden" id="editPlayerId">
                <button type="submit">Lưu</button>
                <div class="loading-spinner" id="editUserSpinner"></div>
            </form>
        </div>
    </div>
    <footer>
        <p>© 2025 Cloud Game PC.</p>
    </footer>
    <script>
        // Particles.js Configuration
        const isMobile = window.innerWidth <= 768;
        if (typeof particlesJS !== 'undefined') {
            try {
                particlesJS('particles-js', {
                    particles: {
                        number: { value: isMobile ? 20 : 50, density: { enable: true, value_area: 800 } },
                        color: { value: '#FFD700' },
                        shape: { type: 'circle' },
                        opacity: { value: 0.5, random: true },
                        size: { value: 3, random: true },
                        line_linked: { enable: true, distance: 150, color: '#FFD700', opacity: 0.4, width: 1 },
                        move: { enable: true, speed: 2, direction: 'none', random: false, straight: false, out_mode: 'out', bounce: false }
                    },
                    interactivity: {
                        detect_on: 'canvas',
                        events: { onhover: { enable: !isMobile, mode: 'repulse' }, onclick: { enable: true, mode: 'push' }, resize: true },
                        modes: { repulse: { distance: 100, duration: 0.4 }, push: { particles_nb: 4 } }
                    },
                    retina_detect: true
                });
            } catch (error) {
                console.error('Lỗi khi khởi tạo Particles.js:', error);
            }
        } else {
            console.warn('Particles.js không tải được, bỏ qua hiệu ứng hạt.');
        }

        // Utility: Hash Password (SHA-256)
        async function hashPassword(password) {
            try {
                const msgBuffer = new TextEncoder().encode(password);
                const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
                return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
            } catch (error) {
                console.error('Lỗi khi mã hóa mật khẩu:', error);
                throw error;
            }
        }

        // Utility: Generate Numeric Player ID
        function generatePlayerId() {
            return Math.floor(100000 + Math.random() * 900000); // Sinh số 6 chữ số
        }

        // Default Data
        const defaultUsers = [
            { username: "Người Chơi 1", email: "player1@example.com", password: "8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92", playerId: 123456, balance: 0 }
        ];
        const defaultPlans = {
            trumbox: { price: 3000, description: "Chơi không giới hạn game. Hỗ trợ trên mọi thiết bị. Băng thông ổn định, độ trễ thấp." },
            premium: { price: 350000, description: "Truy cập toàn bộ game. Hỗ trợ độ phân giải 4K. Máy chủ VIP." }
        };

        // Global State
        let users = JSON.parse(localStorage.getItem('users')) || defaultUsers;
        let plans = JSON.parse(localStorage.getItem('plans')) || defaultPlans;
        let notifications = JSON.parse(localStorage.getItem('notifications')) || [];
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        let isLoggedIn = false;
        let userData = { username: "", email: "", playerId: 0, balance: 0 };

        // DOM Elements
        const authLinks = document.getElementById('authLinks');
        const userInfo = document.getElementById('userInfo');
        const userDetails = document.getElementById('userDetails');
        const balanceDisplay = document.querySelector('.balance');
        const logoutButton = document.getElementById('logoutButton');
        const adminSection = document.getElementById('adminSection');
        const notificationArea = document.getElementById('notificationArea');
        const trumboxPlan = document.getElementById('trumboxPlan');
        const premiumPlan = document.getElementById('premiumPlan');

        // Lock Mechanism for Multi-Device Sync
        function acquireLock() {
            const lock = localStorage.getItem('dataLock');
            if (lock && Date.now() - parseInt(lock) < 10000) {
                return false; // Lock đang được giữ
            }
            localStorage.setItem('dataLock', Date.now());
            return true;
        }

        function releaseLock() {
            localStorage.removeItem('dataLock');
        }

        // Show Loading Spinner
        function showSpinner(spinnerId) {
            const spinner = document.getElementById(spinnerId);
            if (spinner) {
                spinner.style.display = 'block';
            } else {
                console.warn(`Spinner ${spinnerId} không tìm thấy.`);
            }
        }

        // Hide Loading Spinner
        function hideSpinner(spinnerId) {
            const spinner = document.getElementById(spinnerId);
            if (spinner) {
                spinner.style.display = 'none';
            } else {
                console.warn(`Spinner ${spinnerId} không tìm thấy.`);
            }
        }

        // Save Data to LocalStorage
        function saveData() {
            try {
                if (!acquireLock()) {
                    throw new Error('Dữ liệu đang được chỉnh sửa bởi thiết bị khác, vui lòng thử lại.');
                }
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('plans', JSON.stringify(plans));
                localStorage.setItem('notifications', JSON.stringify(notifications));
                localStorage.setItem('transactions', JSON.stringify(transactions));
                localStorage.setItem('userData', JSON.stringify(userData));
                localStorage.setItem('isLoggedIn', isLoggedIn.toString());
                releaseLock();
            } catch (error) {
                console.error('Lỗi khi lưu dữ liệu:', error);
                alert('Có lỗi khi lưu dữ liệu, vui lòng thử lại.');
                releaseLock();
                throw error;
            }
        }

        // Load Data from LocalStorage
        function loadData() {
            try {
                users = JSON.parse(localStorage.getItem('users')) || defaultUsers;
                plans = JSON.parse(localStorage.getItem('plans')) || defaultPlans;
                notifications = JSON.parse(localStorage.getItem('notifications')) || [];
                transactions = JSON.parse(localStorage.getItem('transactions')) || [];
                return { users, plans, notifications, transactions };
            } catch (error) {
                console.error('Lỗi khi tải dữ liệu:', error);
                users = defaultUsers;
                plans = defaultPlans;
                notifications = [];
                transactions = [];
                alert('Có lỗi khi tải dữ liệu, sử dụng dữ liệu mặc định.');
                return { users, plans, notifications, transactions };
            }
        }

        // Update UI Based on Login State
        function updateUserInterface() {
            if (authLinks && userInfo && userDetails && balanceDisplay && adminSection) {
                if (isLoggedIn && userData.playerId) {
                    authLinks.style.display = 'none';
                    userInfo.style.display = 'flex';
                    userDetails.textContent = `${userData.username} (${userData.playerId})`;
                    balanceDisplay.textContent = `Số dư: ${userData.balance} VNĐ`;
                    if (userData.username === 'tominh14' && userData.email === 'tominh14@gmail.com') {
                        adminSection.style.display = 'block';
                        loadUsers();
                        loadTransactions();
                    } else {
                        adminSection.style.display = 'none';
                    }
                } else {
                    authLinks.style.display = 'flex';
                    userInfo.style.display = 'none';
                    userDetails.textContent = '';
                    balanceDisplay.textContent = 'Số dư: 0 VNĐ';
                    adminSection.style.display = 'none';
                }
                updatePlansUI();
                loadNotifications();
            } else {
                console.error('Một số DOM elements không tìm thấy trong updateUserInterface.');
            }
        }

        // Update Plans UI
        function updatePlansUI() {
            if (trumboxPlan && premiumPlan) {
                trumboxPlan.querySelector('.price').textContent = `${plans.trumbox.price} VNĐ/giờ`;
                const trumboxDesc = trumboxPlan.querySelectorAll('p:not(.price):not(.subscribers)');
                const trumboxDescLines = plans.trumbox.description.split('. ').filter(d => d);
                trumboxDesc.forEach((p, i) => p.textContent = trumboxDescLines[i] || '');

                premiumPlan.querySelector('.price').textContent = `${plans.premium.price} VNĐ/Vĩnh Viễn`;
                const premiumDesc = premiumPlan.querySelectorAll('p:not(.price):not(.subscribers)');
                const premiumDescLines = plans.premium.description.split('. ').filter(d => d);
                premiumDesc.forEach((p, i) => p.textContent = premiumDescLines[i] || '');
            } else {
                console.warn('Không tìm thấy trumboxPlan hoặc premiumPlan.');
            }
        }

        // Gift Balance by Player ID
        function giftBalanceById() {
            const giftIdInput = document.getElementById('giftId');
            const giftAmountInput = document.getElementById('giftAmount');
            const giftSuccess = document.getElementById('giftSuccess');
            const giftError = document.getElementById('giftError');

            if (!giftIdInput || !giftAmountInput || !giftSuccess || !giftError) {
                console.error('Không tìm thấy các element trong giftBalanceById.');
                return;
            }

            const giftId = parseInt(giftIdInput.value);
            const giftAmount = parseInt(giftAmountInput.value);

            if (isNaN(giftId) || isNaN(giftAmount) || giftAmount <= 0) {
                giftError.textContent = 'Vui lòng nhập ID và số tiền hợp lệ!';
                giftError.style.display = 'block';
                giftSuccess.style.display = 'none';
                return;
            }

            try {
                loadData();
                const userIndex = users.findIndex(u => u.playerId === giftId);
                if (userIndex === -1) {
                    giftError.textContent = 'Không tìm thấy người dùng!';
                    giftError.style.display = 'block';
                    giftSuccess.style.display = 'none';
                    return;
                }

                users[userIndex].balance += giftAmount;
                saveData();
                logTransaction(giftId, 'Gift', giftAmount);
                giftSuccess.style.display = 'block';
                giftError.style.display = 'none';
                giftIdInput.value = '';
                giftAmountInput.value = '';
                loadUsers();
                loadTransactions();
                setTimeout(() => giftSuccess.style.display = 'none', 2000);
            } catch (error) {
                console.error('Lỗi khi tặng số dư:', error);
                giftError.textContent = 'Có lỗi xảy ra, vui lòng thử lại.';
                giftError.style.display = 'block';
                giftSuccess.style.display = 'none';
            }
        }

        // Load Users for Admin
        function loadUsers() {
            const userTableBody = document.getElementById('userTableBody');
            if (!userTableBody) {
                console.error('Không tìm thấy userTableBody.');
                return;
            }

            try {
                loadData();
                userTableBody.innerHTML = '';
                users.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.username}</td>
                        <td>${user.email}</td>
                        <td>${user.playerId}</td>
                        <td>${user.balance} VNĐ</td>
                        <td>
                            <button onclick="editUser(${user.playerId})">Chỉnh Sửa</button>
                            <button onclick="deleteUser(${user.playerId})">Xóa</button>
                        </td>
                    `;
                    userTableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Lỗi khi tải danh sách người dùng:', error);
                alert('Có lỗi khi tải danh sách người dùng.');
            }
        }

        // Edit User
        function editUser(playerId) {
            const user = users.find(u => u.playerId === playerId);
            if (!user) return;

            const editUserModal = document.getElementById('editUserModal');
            const editUsername = document.getElementById('editUsername');
            const editEmail = document.getElementById('editEmail');
            const editBalance = document.getElementById('editBalance');
            const editPlayerId = document.getElementById('editPlayerId');

            if (editUserModal && editUsername && editEmail && editBalance && editPlayerId) {
                editUsername.value = user.username;
                editEmail.value = user.email;
                editBalance.value = user.balance;
                editPlayerId.value = playerId;
                editUserModal.style.display = 'flex';
            } else {
                console.error('Không tìm thấy các element trong editUser.');
            }
        }

        // Save Edited User
        const editUserForm = document.getElementById('editUserForm');
        if (editUserForm) {
            editUserForm.addEventListener('submit', (e) => {
                e.preventDefault();
                showSpinner('editUserSpinner');
                const editUsername = document.getElementById('editUsername');
                const editEmail = document.getElementById('editEmail');
                const editBalance = document.getElementById('editBalance');
                const editPlayerId = document.getElementById('editPlayerId');
                const editUserError = document.getElementById('editUserError');
                const editUserSuccess = document.getElementById('editUserSuccess');

                if (!editUsername || !editEmail || !editBalance || !editPlayerId || !editUserError || !editUserSuccess) {
                    console.error('Không tìm thấy các element trong editUserForm.');
                    hideSpinner('editUserSpinner');
                    return;
                }

                const playerId = parseInt(editPlayerId.value);
                const username = editUsername.value.trim();
                const email = editEmail.value.trim();
                const balance = parseInt(editBalance.value);

                if (username.length < 3 || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email) || isNaN(balance) || balance < 0) {
                    editUserError.textContent = 'Vui lòng nhập thông tin hợp lệ!';
                    editUserError.style.display = 'block';
                    editUserSuccess.style.display = 'none';
                    hideSpinner('editUserSpinner');
                    return;
                }

                try {
                    loadData();
                    const userIndex = users.findIndex(u => u.playerId === playerId);
                    if (userIndex === -1) {
                        editUserError.textContent = 'Không tìm thấy người dùng!';
                        editUserError.style.display = 'block';
                        editUserSuccess.style.display = 'none';
                        hideSpinner('editUserSpinner');
                        return;
                    }

                    const oldBalance = users[userIndex].balance;
                    users[userIndex] = { ...users[userIndex], username, email, balance };
                    if (userData.playerId === playerId) {
                        userData = { ...userData, username, email, balance };
                    }
                    saveData();
                    logTransaction(playerId, 'Edit Balance', balance - oldBalance);
                    editUserSuccess.style.display = 'block';
                    editUserError.style.display = 'none';
                    document.getElementById('editUserModal').style.display = 'none';
                    loadUsers();
                    updateUserInterface();
                    setTimeout(() => editUserSuccess.style.display = 'none', 2000);
                } catch (error) {
                    console.error('Lỗi khi chỉnh sửa người dùng:', error);
                    editUserError.textContent = 'Có lỗi xảy ra, vui lòng thử lại.';
                    editUserError.style.display = 'block';
                    editUserSuccess.style.display = 'none';
                }
                hideSpinner('editUserSpinner');
            });
        }

        // Delete User
        function deleteUser(playerId) {
            if (!confirm('Bạn có chắc muốn xóa người dùng này?')) return;

            try {
                loadData();
                users = users.filter(u => u.playerId !== playerId);
                if (userData.playerId === playerId) {
                    logout();
                }
                saveData();
                loadUsers();
                updateUserInterface();
            } catch (error) {
                console.error('Lỗi khi xóa người dùng:', error);
                alert('Có lỗi khi xóa người dùng.');
            }
        }

        // Update Plans
        function updatePlans() {
            const trumboxPriceInput = document.getElementById('trumboxPrice');
            const trumboxDescInput = document.getElementById('trumboxDesc');
            const premiumPriceInput = document.getElementById('premiumPrice');
            const premiumDescInput = document.getElementById('premiumDesc');
            const planSuccess = document.getElementById('planSuccess');
            const planError = document.getElementById('planError');

            if (!trumboxPriceInput || !trumboxDescInput || !premiumPriceInput || !premiumDescInput || !planSuccess || !planError) {
                console.error('Không tìm thấy các element trong updatePlans.');
                return;
            }

            const trumboxPrice = parseInt(trumboxPriceInput.value);
            const trumboxDesc = trumboxDescInput.value.trim();
            const premiumPrice = parseInt(premiumPriceInput.value);
            const premiumDesc = premiumDescInput.value.trim();

            if (isNaN(trumboxPrice) || trumboxPrice <= 0 || !trumboxDesc || isNaN(premiumPrice) || premiumPrice <= 0 || !premiumDesc) {
                planError.textContent = 'Vui lòng nhập thông tin hợp lệ!';
                planError.style.display = 'block';
                planSuccess.style.display = 'none';
                return;
            }

            try {
                loadData();
                plans = {
                    trumbox: { price: trumboxPrice, description: trumboxDesc },
                    premium: { price: premiumPrice, description: premiumDesc }
                };
                saveData();
                planSuccess.style.display = 'block';
                planError.style.display = 'none';
                trumboxPriceInput.value = '';
                trumboxDescInput.value = '';
                premiumPriceInput.value = '';
                premiumDescInput.value = '';
                updatePlansUI();
                setTimeout(() => planSuccess.style.display = 'none', 2000);
            } catch (error) {
                console.error('Lỗi khi cập nhật gói:', error);
                planError.textContent = 'Có lỗi xảy ra, vui lòng thử lại.';
                planError.style.display = 'block';
                planSuccess.style.display = 'none';
            }
        }

        // Send Notification
        function sendNotification() {
            const notificationMessageInput = document.getElementById('notificationMessage');
            const notificationSuccess = document.getElementById('notificationSuccess');
            const notificationError = document.getElementById('notificationError');

            if (!notificationMessageInput || !notificationSuccess || !notificationError) {
                console.error('Không tìm thấy các element trong sendNotification.');
                return;
            }

            const message = notificationMessageInput.value.trim();

            if (!message) {
                notificationError.textContent = 'Vui lòng nhập nội dung thông báo!';
                notificationError.style.display = 'block';
                notificationSuccess.style.display = 'none';
                return;
            }

            try {
                loadData();
                notifications.push({
                    message,
                    timestamp: new Date().toISOString()
                });
                saveData();
                notificationSuccess.style.display = 'block';
                notificationError.style.display = 'none';
                notificationMessageInput.value = '';
                loadNotifications();
                setTimeout(() => notificationSuccess.style.display = 'none', 2000);
            } catch (error) {
                console.error('Lỗi khi gửi thông báo:', error);
                notificationError.textContent = 'Có lỗi xảy ra, vui lòng thử lại.';
                notificationError.style.display = 'block';
                notificationSuccess.style.display = 'none';
            }
        }

        // Load Notifications
        function loadNotifications() {
            if (!notificationArea) {
                console.error('Không tìm thấy notificationArea.');
                return;
            }

            try {
                loadData();
                notificationArea.innerHTML = '';
                notifications.forEach(notification => {
                    const div = document.createElement('div');
                    div.className = 'notification';
                    div.textContent = `${notification.message} (${new Date(notification.timestamp).toLocaleString('vi-VN')})`;
                    notificationArea.appendChild(div);
                });
            } catch (error) {
                console.error('Lỗi khi tải thông báo:', error);
            }
        }

        // Log Transaction
        function logTransaction(userId, type, amount) {
            try {
                loadData();
                transactions.push({
                    userId,
                    type,
                    amount,
                    timestamp: new Date().toISOString()
                });
                saveData();
            } catch (error) {
                console.error('Lỗi khi ghi giao dịch:', error);
            }
        }

        // Load Transactions
        function loadTransactions() {
            const transactionTableBody = document.getElementById('transactionTableBody');
            if (!transactionTableBody) {
                console.error('Không tìm thấy transactionTableBody.');
                return;
            }

            try {
                loadData();
                transactionTableBody.innerHTML = '';
                transactions.forEach(t => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${t.userId}</td>
                        <td>${t.type}</td>
                        <td>${t.amount} VNĐ</td>
                        <td>${new Date(t.timestamp).toLocaleString('vi-VN')}</td>
                    `;
                    transactionTableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Lỗi khi tải giao dịch:', error);
            }
        }

        // Rent Trumbox Machine
        function rentTrumbox(event) {
            if (!isLoggedIn) {
                alert('Vui lòng đăng nhập trước khi thuê máy!');
                return;
            }

            showSpinner('trumboxSpinner');
            let button = event?.target;
            if (button) {
                button.disabled = true;
                button.textContent = 'Đang xử lý...';
            }

            try {
                loadData();
                if (userData.balance < plans.trumbox.price) {
                    alert(`Số dư không đủ (cần ít nhất ${plans.trumbox.price} VNĐ)!`);
                    if (button) {
                        button.disabled = false;
                        button.textContent = 'Thuê Ngay';
                    }
                    hideSpinner('trumboxSpinner');
                    return;
                }

                userData.balance -= plans.trumbox.price;
                const userIndex = users.findIndex(u => u.playerId === userData.playerId);
                if (userIndex !== -1) {
                    users[userIndex].balance = userData.balance;
                }
                saveData();
                logTransaction(userData.playerId, 'Rent Trumbox', -plans.trumbox.price);
                alert('Thuê máy thành công! Đang chuyển đến Trumbox...');
                window.open('https://trumbox.net/cloud-gaming/play/', '_blank');
            } catch (error) {
                console.error('Lỗi khi thuê máy:', error);
                alert('Có lỗi xảy ra, vui lòng thử lại.');
            }

            if (button) {
                button.disabled = false;
                button.textContent = 'Thuê Ngay';
            }
            hideSpinner('trumboxSpinner');
            updateUserInterface();
        }

        // Purchase Plan
        function purchasePlan(planName, price, event) {
            if (!isLoggedIn) {
                alert('Vui lòng đăng nhập trước khi mua gói!');
                return;
            }
            if (userData.balance < price) {
                alert('Số dư không đủ để mua gói này!');
                return;
            }

            showSpinner('premiumSpinner');
            let button = event?.target;
            if (button) {
                button.disabled = true;
                button.textContent = 'Đang xử lý...';
            }

            try {
                loadData();
                userData.balance -= price;
                const userIndex = users.findIndex(u => u.playerId === userData.playerId);
                if (userIndex !== -1) {
                    users[userIndex].balance = userData.balance;
                }
                saveData();
                logTransaction(userData.playerId, 'Purchase Premium', -price);
                alert(`Đã mua ${planName} thành công!`);
            } catch (error) {
                console.error('Lỗi khi mua gói:', error);
                alert('Có lỗi xảy ra, vui lòng thử lại.');
            }

            if (button) {
                button.disabled = false;
                button.textContent = 'Mua Gói';
            }
            hideSpinner('premiumSpinner');
            updateUserInterface();
        }

        // Logout
        function logout() {
            isLoggedIn = false;
            userData = { username: "", email: "", playerId: 0, balance: 0 };
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userData');
            updateUserInterface();
        }

        // Initialize
        function initialize() {
            try {
                loadData();
                isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
                userData = JSON.parse(localStorage.getItem('userData')) || { username: "", email: "", playerId: 0, balance: 0 };
                updateUserInterface();
            } catch (error) {
                console.error('Lỗi khi khởi tạo:', error);
                alert('Có lỗi khi khởi tạo ứng dụng, vui lòng thử lại.');
            }
        }

        initialize();

        // Event Listeners
        if (logoutButton) {
            logoutButton.addEventListener('click', logout);
        }

        // Topup Modal (giữ nguyên logic gốc, chỉ thêm kiểm tra null và xử lý lỗi cơ bản)
        const topupModal = document.getElementById('topupModal');
        const topupLink = document.getElementById('topupLink');
        const closeTopupModal = document.getElementById('closeTopupModal');
        const topupForm = document.getElementById('topupForm');
        const topupSuccess = document.getElementById('topupSuccess');
        const topupError = document.getElementById('topupError');
        const paymentMethodSelect = document.getElementById('paymentMethod');

        function toggleForm() {
            const paymentMethod = paymentMethodSelect?.value;
            const bankForm = document.getElementById('bankForm');
            const cardForm = document.getElementById('cardForm');
            if (bankForm && cardForm) {
                bankForm.style.display = paymentMethod === 'bank' ? 'block' : 'none';
                cardForm.style.display = paymentMethod === 'card' ? 'block' : 'none';
            } else {
                console.warn('Không tìm thấy bankForm hoặc cardForm.');
            }
        }

        if (topupLink) {
            topupLink.addEventListener('click', (e) => {
                e.preventDefault();
                if (topupModal && topupSuccess && topupError && topupForm) {
                    topupModal.style.display = 'flex';
                    topupSuccess.style.display = 'none';
                    topupError.style.display = 'none';
                    topupForm.reset();
                    toggleForm();
                } else {
                    console.error('Không tìm thấy các element trong topupLink.');
                }
            });
        }

        if (closeTopupModal) {
            closeTopupModal.addEventListener('click', () => {
                if (topupModal) topupModal.style.display = 'none';
            });
        }

        if (topupForm) {
            topupForm.addEventListener('submit', (e) => {
                e.preventDefault();
                if (!isLoggedIn) {
                    if (topupError) {
                        topupError.textContent = 'Vui lòng đăng nhập trước khi nạp tiền!';
                        topupError.style.display = 'block';
                        if (topupSuccess) topupSuccess.style.display = 'none';
                    }
                    return;
                }

                showSpinner('topupSpinner');
                try {
                    if (topupSuccess && topupError) {
                        topupSuccess.style.display = 'block';
                        topupError.style.display = 'none';
                    }
                    topupForm.reset();
                    toggleForm();
                    setTimeout(() => {
                        if (topupModal) topupModal.style.display = 'none';
                        if (topupSuccess) topupSuccess.style.display = 'none';
                    }, 2000);
                } catch (error) {
                    console.error('Lỗi khi gửi yêu cầu nạp tiền:', error);
                    if (topupError) {
                        topupError.textContent = 'Có lỗi xảy ra, vui lòng thử lại.';
                        topupError.style.display = 'block';
                        if (topupSuccess) topupSuccess.style.display = 'none';
                    }
                }
                hideSpinner('topupSpinner');
            });
        }

        // Login Modal
        const loginModal = document.getElementById('loginModal');
        const loginLink = document.getElementById('loginLink');
        const closeLoginModal = document.getElementById('closeLoginModal');
        const loginForm = document.getElementById('loginForm');
        const loginError = document.getElementById('loginError');

        if (loginLink) {
            loginLink.addEventListener('click', (e) => {
                e.preventDefault();
                if (loginModal && topupModal && registerModal && loginError && loginForm) {
                    loginModal.style.display = 'flex';
                    topupModal.style.display = 'none';
                    registerModal.style.display = 'none';
                    loginError.style.display = 'none';
                    loginForm.reset();
                } else {
                    console.error('Không tìm thấy các element trong loginLink.');
                }
            });
        }

        if (closeLoginModal) {
            closeLoginModal.addEventListener('click', () => {
                if (loginModal) loginModal.style.display = 'none';
            });
        }

        if (loginForm) {
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                showSpinner('loginSpinner');
                const loginEmail = document.getElementById('loginEmail');
                const loginPassword = document.getElementById('loginPassword');

                if (!loginEmail || !loginPassword) {
                    console.error('Không tìm thấy loginEmail hoặc loginPassword.');
                    hideSpinner('loginSpinner');
                    return;
                }

                const email = loginEmail.value.trim();
                const password = loginPassword.value.trim();

                try {
                    loadData();
                    const hashedPassword = await hashPassword(password);
                    const user = users.find(u => u.email === email && u.password === hashedPassword);

                    if (!user) {
                        if (loginError) {
                            loginError.textContent = 'Email hoặc mật khẩu không đúng!';
                            loginError.style.display = 'block';
                        }
                        hideSpinner('loginSpinner');
                        return;
                    }

                    isLoggedIn = true;
                    userData = { username: user.username, email: user.email, playerId: user.playerId, balance: user.balance };
                    saveData();
                    updateUserInterface();
                    if (loginModal) loginModal.style.display = 'none';
                    loginForm.reset();
                } catch (error) {
                    console.error('Lỗi khi đăng nhập:', error);
                    if (loginError) {
                        loginError.textContent = 'Có lỗi xảy ra, vui lòng thử lại.';
                        loginError.style.display = 'block';
                    }
                }
                hideSpinner('loginSpinner');
            });
        }

        // Register Modal
        const registerModal = document.getElementById('registerModal');
        const registerLink = document.getElementById('registerLink');
        const closeRegisterModal = document.getElementById('closeRegisterModal');
        const registerForm = document.getElementById('registerForm');
        const registerError = document.getElementById('registerError');
        const registerSuccess = document.getElementById('registerSuccess');
        const showLogin = document.getElementById('showLogin');
        const showRegister = document.getElementById('showRegister');

        if (registerLink) {
            registerLink.addEventListener('click', (e) => {
                e.preventDefault();
                if (registerModal && topupModal && loginModal && registerError && registerSuccess && registerForm) {
                    registerModal.style.display = 'flex';
                    topupModal.style.display = 'none';
                    loginModal.style.display = 'none';
                    registerError.style.display = 'none';
                    registerSuccess.style.display = 'none';
                    registerForm.reset();
                } else {
                    console.error('Không tìm thấy các element trong registerLink.');
                }
            });
        }

        if (closeRegisterModal) {
            closeRegisterModal.addEventListener('click', () => {
                if (registerModal) registerModal.style.display = 'none';
            });
        }

        if (showLogin) {
            showLogin.addEventListener('click', (e) => {
                e.preventDefault();
                if (loginModal && registerModal) {
                    loginModal.style.display = 'flex';
                    registerModal.style.display = 'none';
                }
            });
        }

        if (showRegister) {
            showRegister.addEventListener('click', (e) => {
                e.preventDefault();
                if (registerModal && loginModal) {
                    registerModal.style.display = 'flex';
                    loginModal.style.display = 'none';
                }
            });
        }

        if (registerForm) {
            registerForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                showSpinner('registerSpinner');
                const registerUsername = document.getElementById('registerUsername');
                const registerEmail = document.getElementById('registerEmail');
                const registerPassword = document.getElementById('registerPassword');
                const confirmPassword = document.getElementById('confirmPassword');

                if (!registerUsername || !registerEmail || !registerPassword || !confirmPassword) {
                    console.error('Không tìm thấy các element trong registerForm.');
                    hideSpinner('registerSpinner');
                    return;
                }

                const username = registerUsername.value.trim();
                const email = registerEmail.value.trim();
                const password = registerPassword.value;
                const confirmPasswordValue = confirmPassword.value;

                let errorMessage = '';
                if (username.length < 3) {
                    errorMessage = 'Tên người dùng phải có ít nhất 3 ký tự.';
                } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                    errorMessage = 'Email không hợp lệ.';
                } else if (password.length < 6 || !/[A-Z]/.test(password) || !/[0-9]/.test(password)) {
                    errorMessage = 'Mật khẩu phải có ít nhất 6 ký tự, bao gồm chữ hoa và số.';
                } else if (password !== confirmPasswordValue) {
                    errorMessage = 'Mật khẩu xác nhận không khớp.';
                } else if (users.some(u => u.email === email)) {
                    errorMessage = 'Email đã được sử dụng!';
                } else if (users.some(u => u.username === username)) {
                    errorMessage = 'Tên người dùng đã được sử dụng!';
                }

                if (errorMessage) {
                    if (registerError) {
                        registerError.textContent = errorMessage;
                        registerError.style.display = 'block';
                        registerSuccess.style.display = 'none';
                    }
                    hideSpinner('registerSpinner');
                    return;
                }

                try {
                    loadData();
                    const hashedPassword = await hashPassword(password);
                    let playerId;
                    do {
                        playerId = generatePlayerId();
                    } while (users.some(u => u.playerId === playerId));
                    const newUser = {
                        username,
                        email,
                        password: hashedPassword,
                        playerId,
                        balance: 0
                    };
                    users.push(newUser);
                    isLoggedIn = true;
                    userData = { username, email, playerId, balance: 0 };
                    saveData();
                    if (registerSuccess && registerError) {
                        registerSuccess.style.display = 'block';
                        registerError.style.display = 'none';
                    }
                    updateUserInterface();
                    setTimeout(() => {
                        if (registerModal) registerModal.style.display = 'none';
                        if (registerSuccess) registerSuccess.style.display = 'none';
                    }, 2000);
                    registerForm.reset();
                } catch (error) {
                    console.error('Lỗi khi đăng ký:', error);
                    if (registerError) {
                        registerError.textContent = 'Có lỗi xảy ra, vui lòng thử lại.';
                        registerError.style.display = 'block';
                        registerSuccess.style.display = 'none';
                    }
                }
                hideSpinner('registerSpinner');
            });
        }

        // Hamburger Menu
        const hamburger = document.querySelector('.hamburger');
        const menu = document.querySelector('.menu');
        if (hamburger && menu) {
            hamburger.addEventListener('click', () => {
                menu.classList.toggle('active');
            });
        }
    </script>
</body>
</html>
